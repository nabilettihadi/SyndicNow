<!-- En-tête -->
<header class="bg-white shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="md:flex md:items-center md:justify-between">
      <div class="flex-1 min-w-0">
        <h1 class="text-2xl font-bold text-gray-900">
          Modifier l'immeuble
        </h1>
        <p class="mt-1 text-sm text-gray-500">
          Modifiez les informations de l'immeuble "{{ immeuble?.nom }}"
        </p>
      </div>
      <div class="mt-4 flex md:mt-0 md:ml-4">
        <button type="button" (click)="retour()"
                class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          <i class="fas fa-arrow-left -ml-1 mr-2"></i>
          Retour
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Contenu principal -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Chargement -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"></div>
  </div>

  <!-- Erreur de chargement -->
  <div *ngIf="error && !immeubleForm" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mt-6">
    {{ error }}
    <div class="mt-2">
      <button type="button" (click)="retour()"
              class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
        Retour à la liste
      </button>
    </div>
  </div>

  <!-- Formulaire d'édition -->
  <div *ngIf="immeubleForm" class="bg-white shadow overflow-hidden sm:rounded-lg">
    <form [formGroup]="immeubleForm" (ngSubmit)="onSubmit()">
      <div class="border-b border-gray-200 px-4 py-5 sm:px-6">
        <h3 class="text-lg leading-6 font-medium text-gray-900">
          Informations de l'immeuble
        </h3>
        <p class="mt-1 text-sm text-gray-500">
          Tous les champs marqués d'un astérisque (*) sont obligatoires.
        </p>
      </div>

      <div class="px-4 py-5 sm:p-6">
        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
          <!-- Nom de l'immeuble -->
          <div class="sm:col-span-3">
            <label for="nom" class="block text-sm font-medium text-gray-700">
              Nom de l'immeuble *
            </label>
            <div class="mt-1">
              <input type="text"
                     id="nom"
                     formControlName="nom"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
            <div *ngIf="f['nom'].touched && f['nom'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['nom'].errors?.['required']">Le nom de l'immeuble est requis.</div>
            </div>
          </div>

          <!-- Adresse -->
          <div class="sm:col-span-6">
            <label for="adresse" class="block text-sm font-medium text-gray-700">
              Adresse *
            </label>
            <div class="mt-1">
              <input type="text"
                     id="adresse"
                     formControlName="adresse"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
            <div *ngIf="f['adresse'].touched && f['adresse'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['adresse'].errors?.['required']">L'adresse est requise.</div>
            </div>
          </div>

          <!-- Code postal -->
          <div class="sm:col-span-2">
            <label for="codePostal" class="block text-sm font-medium text-gray-700">
              Code postal *
            </label>
            <div class="mt-1">
              <input type="text"
                     id="codePostal"
                     formControlName="codePostal"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
            <div *ngIf="f['codePostal'].touched && f['codePostal'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['codePostal'].errors?.['required']">Le code postal est requis.</div>
            </div>
          </div>

          <!-- Ville -->
          <div class="sm:col-span-4">
            <label for="ville" class="block text-sm font-medium text-gray-700">
              Ville *
            </label>
            <div class="mt-1">
              <input type="text"
                     id="ville"
                     formControlName="ville"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
            <div *ngIf="f['ville'].touched && f['ville'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['ville'].errors?.['required']">La ville est requise.</div>
            </div>
          </div>

          <!-- Date de construction -->
          <div class="sm:col-span-3">
            <label for="dateConstruction" class="block text-sm font-medium text-gray-700">
              Date de construction
            </label>
            <div class="mt-1">
              <input type="date"
                     id="dateConstruction"
                     formControlName="dateConstruction"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
          </div>

          <!-- Nombre d'étages -->
          <div class="sm:col-span-3">
            <label for="nombreEtages" class="block text-sm font-medium text-gray-700">
              Nombre d'étages *
            </label>
            <div class="mt-1">
              <input type="number"
                     id="nombreEtages"
                     formControlName="nombreEtages"
                     min="0"
                     class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
            </div>
            <div *ngIf="f['nombreEtages'].touched && f['nombreEtages'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['nombreEtages'].errors?.['required']">Le nombre d'étages est requis.</div>
              <div *ngIf="f['nombreEtages'].errors?.['min']">Le nombre d'étages doit être supérieur ou égal à 0.</div>
            </div>
          </div>

          <!-- Statut -->
          <div class="sm:col-span-3">
            <label for="status" class="block text-sm font-medium text-gray-700">
              Statut *
            </label>
            <div class="mt-1">
              <select id="status"
                      formControlName="status"
                      class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
                <option value="ACTIF">Actif</option>
                <option value="EN_TRAVAUX">En travaux</option>
                <option value="INACTIF">Inactif</option>
              </select>
            </div>
            <div *ngIf="f['status'].touched && f['status'].invalid" class="mt-1 text-sm text-red-600">
              <div *ngIf="f['status'].errors?.['required']">Le statut est requis.</div>
            </div>
          </div>

          <!-- Syndic -->
          <div class="sm:col-span-6">
            <label for="syndicId" class="block text-sm font-medium text-gray-700">
              Syndic
            </label>
            <div class="mt-1">
              <select id="syndicId"
                      formControlName="syndicId"
                      class="shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md">
                <option [ngValue]="null">-- Aucun syndic assigné --</option>
                <option *ngFor="let syndic of syndics" [value]="syndic.id">
                  {{ syndic.nom }} - {{ syndic.ville }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Message d'erreur -->
      <div *ngIf="error && immeubleForm"
           class="bg-red-50 border border-red-200 text-sm text-red-700 px-4 py-3 rounded-md mx-4 mb-4">
        {{ error }}
      </div>

      <!-- Message de succès -->
      <div *ngIf="success"
           class="bg-green-50 border border-green-200 text-sm text-green-700 px-4 py-3 rounded-md mx-4 mb-4">
        {{ success }}
      </div>

      <div class="px-4 py-3 bg-gray-50 text-right sm:px-6 flex justify-end space-x-3">
        <button type="button"
                (click)="resetForm()"
                class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
          Réinitialiser
        </button>
        <button type="submit"
                [disabled]="immeubleForm.invalid || isSubmitting"
                class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed">
          <span *ngIf="isSubmitting" class="mr-2">
            <i class="fas fa-spinner fa-spin"></i>
          </span>
          Enregistrer les modifications
        </button>
      </div>
    </form>
  </div>
</main>
